<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Data Analyzer - LAILA</title>
    <link rel="stylesheet" href="unified-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="navigation.js"></script>
    <style>
        .page-subtitle {
            margin-bottom: 40px;
            font-style: italic;
        }
        
        .upload-section {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .upload-section.dragover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        
        .upload-icon {
            font-size: 4em;
            color: #007bff;
            margin-bottom: 20px;
        }
        
        .upload-text {
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .upload-limits {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }
        
        .text-input-section {
            margin-bottom: 30px;
        }
        
        .text-input {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .text-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
        }
        
        .analyze-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 30px;
            font-size: 1.3em;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }
        
        .analyze-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(40, 167, 69, 0.4);
        }
        
        .analyze-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #6c757d;
            font-style: italic;
            margin: 20px 0;
        }
        
        .file-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .analysis-result {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            display: none;
            line-height: 1.8;
        }
        
        .analysis-result h3 {
            margin-top: 0;
            font-size: 1.8em;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .analysis-content {
            font-size: 1.1em;
            white-space: pre-wrap;
        }
        
        .back-link {
            display: inline-block;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .data-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .data-type {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #007bff;
        }
        
        .data-type-icon {
            font-size: 2em;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .data-type-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .data-type-desc {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .data-type.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .data-type.clickable:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.2);
        }
        
        .data-type.selected {
            border-left: 4px solid #28a745;
            background: #e8f5e8;
        }
        
        .conditional-section {
            display: none;
            margin: 30px 0;
        }
        
        .chat-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            display: none;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
        }
        
        .chat-message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            max-width: 85%;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chat-message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .chat-message.ai {
            background: #e9ecef;
            color: #333;
            margin-right: auto;
            border-left: 4px solid #007bff;
        }
        
        .chat-input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            min-height: 50px;
            max-height: 150px;
            transition: border-color 0.3s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
        }
        
        .chat-send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .chat-send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .chat-send-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .refine-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .refine-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="content-card">
            <h1 class="page-title">üîç AI Data Interpreter</h1>
            <p class="page-subtitle">Expert interpretation of statistical results, visualizations, and analytical outputs</p>
            
            <!-- Prominent Fill Test Data Button at the Top -->
            <div style="text-align: center; margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); border-radius: 15px; box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4); border: 2px solid rgba(255,255,255,0.2);">
                <h3 style="color: white; margin-bottom: 15px; font-size: 1.4em; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                    <i class="fas fa-magic"></i> Quick Start with Sample Data
                </h3>
                <p style="color: rgba(255,255,255,0.95); margin-bottom: 25px; font-size: 1.1em; line-height: 1.5;">
                    Don't have data ready? Try our sample data to see how the AI interpreter works!<br>
                    <strong>Click the button below to automatically fill the form with realistic test data.</strong>
                </p>
                <button onclick="fillTestData()" style="background: white; color: #ff6b6b; border: none; padding: 18px 35px; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; font-size: 18px; font-weight: bold; box-shadow: 0 6px 15px rgba(0,0,0,0.3); text-transform: uppercase; letter-spacing: 1px;">
                    <i class="fas fa-magic"></i> Fill Test Data
                </button>
                <p style="color: rgba(255,255,255,0.8); margin-top: 15px; font-size: 0.9em; font-style: italic;">
                    This will populate realistic educational research data for testing
                </p>
            </div>
            
            <!-- Debug Info -->
            <div id="debug-info" style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 20px; font-family: monospace; font-size: 12px; color: #666; display: none;">
                <strong>Debug:</strong> AI Model: <span id="ai-model-name">Loading...</span>
            </div>
            
            <!-- Step 1: Problem, Context and Target -->
            <div class="description-section" style="background: #e8f4fd; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #007bff;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üéØ Step 1: Problem, Context and Target of Analysis</h3>
                <textarea id="data-description" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; min-height: 100px; box-sizing: border-box;" placeholder="Describe the problem you're investigating, the context of your research, and what you want to achieve with this analysis (e.g., 'Investigating whether online learning is more effective than traditional classroom learning for undergraduate mathematics students. Want to understand if the difference is statistically and practically significant.')"></textarea>
            </div>

            <!-- Step 2: Analysis Output -->
            <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin: 30px 0;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Step 2: Paste Analysis Output (T-test, ANOVA, etc.)</h3>
                
                <!-- Image Upload Section -->
                <div class="upload-section" id="main-upload-section" style="margin-bottom: 20px;">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">
                        <strong>Upload Image/Chart (Optional)</strong>
                    </div>
                    <div class="upload-limits">
                        Maximum file size: 1MB | Supported: JPG, PNG, GIF
                    </div>
                    <input type="file" id="main-file-input" class="file-input" accept=".jpg,.jpeg,.png,.gif">
                    <button class="upload-button" onclick="document.getElementById('main-file-input').click()">
                        <i class="fas fa-upload"></i> Choose Image
                    </button>
                </div>
                
                <div class="file-info" id="main-file-info" style="display: none; margin-bottom: 20px;">
                    <strong>Image Selected:</strong> <span id="main-file-name"></span><br>
                    <strong>Size:</strong> <span id="main-file-size"></span>
                    <div id="main-file-thumbnail" style="margin-top: 10px;"></div>
                </div>

                <!-- Text Input Section -->
                <div class="text-input-section">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">Or paste your statistical output/data directly:</h4>
                    <textarea id="text-input" class="text-input" placeholder="Paste your statistical output, test results, or data here...

Examples:
- T-test results from SPSS/R/Python
- ANOVA output tables
- Correlation matrices
- Descriptive statistics
- Network analysis results
- Process mining outputs
- Transition network data
- Any statistical visualization or table"></textarea>
                </div>
            </div>

            <!-- Step 3: Data Upload Evidence -->
            <div id="data-evidence-section" style="background: #e8f5e8; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #28a745; display: none;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">‚úÖ Step 3: Data Upload Evidence</h3>
                <div id="evidence-content">
                    <!-- This will be populated when data is uploaded -->
                </div>
            </div>

            <!-- Step 4: Analysis Type -->
            <div style="background: #fff3cd; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #ffc107;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üîç Step 4: Analysis Type</h3>
                <select id="analysis-type" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                    <option value="">Select the type of analysis to interpret...</option>
                    <option value="statistical_test">Statistical Test Results (t-test, ANOVA, chi-square, etc.)</option>
                    <option value="descriptive_stats">Descriptive Statistics (means, frequencies, distributions)</option>
                    <option value="correlation">Correlation/Regression Analysis</option>
                    <option value="network_analysis">Network Analysis (social networks, process mining)</option>
                    <option value="transition_network">Transition Network Analysis (state changes, pathways)</option>
                    <option value="visualization">Chart/Graph Interpretation</option>
                    <option value="comparative">Comparative Analysis (group differences)</option>
                    <option value="longitudinal">Longitudinal/Time Series Analysis</option>
                    <option value="other">Other (specify in context section)</option>
                </select>
            </div>

            <!-- Step 4: Research Context -->
            <div style="background: #d4edda; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #28a745;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìù Step 4: Research Context</h3>
                <textarea id="research-context" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; min-height: 100px; box-sizing: border-box;" placeholder="Describe your research context (e.g., 'Study comparing online vs traditional learning effectiveness in undergraduate mathematics courses')"></textarea>
            </div>
            
            <!-- Step 5: Target Insights -->
            <div style="background: #fff3cd; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #ffc107;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üéØ Step 5: Target Insights</h3>
                <textarea id="target-insights" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; min-height: 100px; box-sizing: border-box;" placeholder="What specific insights are you looking for? (e.g., 'Identify key factors that predict student success, understand intervention effectiveness, develop early warning systems')"></textarea>
                </div>
                
            <!-- Step 6: Audience Level -->
            <div style="background: #e8f4fd; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #007bff;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üë• Step 6: Audience Level</h3>
                <select id="audience-level" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                    <option value="">Select the audience level for your analysis...</option>
                    <option value="undergraduate">Undergraduate Students</option>
                    <option value="graduate">Graduate Students</option>
                    <option value="researcher">Researchers/Academics</option>
                    <option value="educator">Educators/Teachers</option>
                    <option value="administrator">Administrators</option>
                    <option value="general">General Public</option>
                    </select>
                </div>
                
            <!-- AI Configuration Info -->
            <div style="background: #f0f8ff; padding: 30px; border-radius: 12px; margin: 30px 0; border-left: 5px solid #007bff;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">ü§ñ AI Configuration</h3>
                
                <div style="background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="color: #0c5460; margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> Using Global Settings
                    </h4>
                    <p style="color: #0c5460; margin-bottom: 8px; font-size: 14px;">
                        ‚Ä¢ AI model selection is now managed globally in <a href="user-settings.html" style="color: #007bff; text-decoration: none; font-weight: bold;">User Settings</a>
                    </p>
                    <p style="color: #0c5460; margin-bottom: 8px; font-size: 14px;">
                        ‚Ä¢ Your preferences apply to all LAILA tools automatically
                    </p>
                    <p style="color: #0c5460; font-size: 14px;">
                        ‚Ä¢ System will use your settings with fallback to default keys
                    </p>
                </div>
                
                <div id="current-config" style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 15px;">
                    <h4 style="color: #155724; margin-bottom: 10px;">
                        <i class="fas fa-cog"></i> Current Configuration
                    </h4>
                    <div id="config-details" style="color: #155724; font-size: 14px;">
                        Loading configuration...
                    </div>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <i class="fas fa-spinner fa-spin"></i> Analyzing your data...
            </div>
            
            <button id="analyze-button" class="analyze-button">
                <i class="fas fa-microscope"></i> Interpret Data
            </button>
            
            <!-- Conditional Input Sections -->
            <div class="conditional-section" id="statistical-section">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Step 2: Statistical Test Data</h3>
                <div class="text-input-section">
                    <textarea id="statistical-input" class="text-input" placeholder="Paste your statistical test output here...

Examples:
- T-test: t(28) = 2.45, p = 0.021, Cohen's d = 0.89
- ANOVA: F(2,87) = 5.67, p = 0.005, Œ∑¬≤ = 0.115
- Regression: R¬≤ = 0.234, F(3,96) = 9.78, p < 0.001
- Chi-square: œá¬≤(2) = 8.45, p = 0.015, Cramer's V = 0.29"></textarea>
                </div>
            </div>

            <div class="conditional-section" id="descriptive-section">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìà Step 2: Descriptive Statistics</h3>
                <div class="text-input-section">
                    <textarea id="descriptive-input" class="text-input" placeholder="Paste your descriptive statistics here...

Examples:
- Mean = 85.4, SD = 12.3, N = 150
- Median = 78, IQR = 15-92, Range = 45-98
- Frequency table with percentages
- Correlation matrix
- Cross-tabulation results"></textarea>
                </div>
            </div>

            <div class="conditional-section" id="network-section">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üï∏Ô∏è Step 2: Network Analysis Data</h3>
                <div class="text-input-section">
                    <textarea id="network-input" class="text-input" placeholder="Paste your network analysis results here...

Examples:
- Social Network: Density = 0.34, Centralization = 0.67
- Process Mining: 15 activities, 8 decision points, 3 loops
- Transition Network: 12 states, 45 transitions, avg path length = 4.2
- Centrality measures: Betweenness, Closeness, Eigenvector
- Community detection results"></textarea>
                </div>
            </div>

            <div class="conditional-section" id="image-section">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üñºÔ∏è Step 2: Upload Image/Chart</h3>
                <div class="upload-section" id="image-upload-section">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">
                        <strong>Upload your chart, graph, or visualization</strong>
                    </div>
                    <div class="upload-limits">
                        Maximum file size: 1MB | Supported: JPG, PNG, GIF
                    </div>
                    <input type="file" id="image-input" class="file-input" accept=".jpg,.jpeg,.png,.gif">
                    <button class="upload-button" onclick="document.getElementById('image-input').click()">
                        <i class="fas fa-upload"></i> Choose Image
                    </button>
                </div>
            </div>

            <div class="analysis-result" id="analysis-result">
                <h3>üìã Initial Analysis</h3>
                <div class="analysis-content" id="analysis-content"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="refine-button" onclick="startChat()">
                        <i class="fas fa-comments"></i> Discuss & Refine Analysis
                    </button>
                    <button class="refine-button" onclick="generateProfessionalPrompt()" style="background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);">
                        <i class="fas fa-magic"></i> Get Professional Prompt
                    </button>
                </div>
            </div>

            <!-- Professional Prompt Section -->
            <div class="analysis-result" id="prompt-result" style="background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%); display: none;">
                <h3>üéØ Professional AI Prompt</h3>
                <p style="margin-bottom: 20px; opacity: 0.9;">Use this optimized prompt with any AI model (ChatGPT, Claude, Gemini, etc.) to get similar analysis results:</p>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <textarea id="professional-prompt" readonly style="width: 100%; min-height: 200px; background: rgba(255,255,255,0.9); color: #333; padding: 15px; border: none; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; box-sizing: border-box; resize: vertical;"></textarea>
                </div>
                <div style="text-align: center;">
                    <button class="refine-button" onclick="copyPromptToClipboard()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);">
                        <i class="fas fa-copy"></i> Copy Prompt
                    </button>
                    <button class="refine-button" onclick="downloadPrompt()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);">
                        <i class="fas fa-download"></i> Download as Text
                    </button>
                </div>
            </div>

            <!-- Interactive Chat Section -->
            <div class="chat-section" id="chat-section">
                <h3 style="color: #2c3e50; text-align: center; margin-bottom: 20px;">üí¨ Interactive Analysis Discussion</h3>
                <p style="text-align: center; color: #7f8c8d; margin-bottom: 20px;">
                    Discuss your analysis with AI! Ask questions, request clarifications, or explore different interpretations.
                </p>
                
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-message ai">
                        <strong>AI Interpreter:</strong> Great! I've provided an initial analysis of your data. Now let's discuss it further. You can:
                        <br><br>
                        ‚Ä¢ <strong>Ask questions</strong> about specific parts of the analysis<br>
                        ‚Ä¢ <strong>Request clarifications</strong> on statistical concepts<br>
                        ‚Ä¢ <strong>Explore implications</strong> for your research<br>
                        ‚Ä¢ <strong>Discuss limitations</strong> and alternative interpretations<br>
                        ‚Ä¢ <strong>Refine the context</strong> for better insights<br>
                        <br>
                        What would you like to discuss about your analysis?
                    </div>
                </div>
                
                <div class="loading" id="chat-loading" style="display: none; text-align: center; color: #6c757d; font-style: italic; margin: 10px 0;">
                    <i class="fas fa-spinner fa-spin"></i> AI is thinking...
                </div>
                
                <div class="chat-input-container">
                    <textarea id="chat-input" class="chat-input" placeholder="Ask about your analysis, request clarifications, or explore different interpretations..." rows="2"></textarea>
                    <button id="chat-send" class="chat-send-button" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User session management
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        // Global variables for AI configuration
        let userSettings = {};
        let availableModels = {};
        let currentAnalysis = '';
        let chatHistory = [];
        
        // Enhanced logging function
        function logUserInteraction(action, elementId = null, elementType = null, elementValue = null, additionalData = {}) {
            fetch('/api/log-interaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: action,
                    page: 'data_analyzer',
                    element_id: elementId,
                    element_type: elementType,
                    element_value: elementValue,
                    interaction_type: 'user_action',
                    details: JSON.stringify(additionalData),
                    session_data: ''
                })
            }).catch(console.error);
        }
        
        // Enhanced chat logging function
        function logChatInteraction(chatType, messageType, content, contextData = null, aiModel = null, aiResponse = null, processingTime = null) {
            fetch('/api/log-chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_type: chatType,
                    message_type: messageType,
                    content: content,
                    context_data: contextData,
                    ai_model: aiModel,
                    ai_response: aiResponse,
                    processing_time: processingTime
                })
            }).catch(console.error);
        }

        // Log page load and get debug info
        fetch('/api/log-interaction', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                user_id: userId,
                interaction_type: 'page_load',
                page: 'data_analyzer',
                action: 'data_analyzer_opened',
                details: 'User opened data analyzer tool',
                session_data: ''
            })
        }).catch(console.error);

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserSettings();
            loadAIConfiguration();
            setupEventListeners();
        });

        // Load user settings
        async function loadUserSettings() {
            try {
                const response = await fetch('/api/user-settings');
                const result = await response.json();
                
                if (result.success) {
                    userSettings = result.settings;
                    updateConfigurationDisplay();
                }
            } catch (error) {
                console.error('Error loading user settings:', error);
            }
        }

        // Load AI configuration
        async function loadAIConfiguration() {
            try {
                const response = await fetch('/api/ai-config');
                const config = await response.json();
                availableModels = config.available_models;
            } catch (error) {
                console.error('Error loading AI configuration:', error);
            }
        }

        // Update configuration display
        function updateConfigurationDisplay() {
            const configDetails = document.getElementById('config-details');
            if (configDetails) {
                const service = userSettings.ai_service || 'google';
                const model = userSettings.ai_model || 'gemini-1.5-flash';
                const useCustomKeys = userSettings.use_custom_keys || false;
                
                let configText = `
                    <strong>Service:</strong> ${service.charAt(0).toUpperCase() + service.slice(1)}<br>
                    <strong>Model:</strong> ${model}<br>
                    <strong>API Keys:</strong> ${useCustomKeys ? 'Using custom keys' : 'Using system defaults'}<br>
                    <strong>Audience Level:</strong> ${userSettings.default_audience || 'graduate'}
                `;
                
                configDetails.innerHTML = configText;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Analysis type selector
            const analysisTypeSelect = document.getElementById('analysis-type');
            if (analysisTypeSelect) {
                analysisTypeSelect.addEventListener('change', function() {
                    logUserInteraction('analysis_type_changed', 'analysis-type', 'select', this.value, {
                        previous_value: currentAnalysis,
                        new_value: this.value
                    });
                    toggleInputSections();
                });
            }
            
            // File input handlers
            const fileInput = document.getElementById('main-file-input');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    logUserInteraction('file_uploaded', 'main-file-input', 'file', file ? file.name : null, {
                        file_size: file ? file.size : 0,
                        file_type: file ? file.type : null
                    });
                    handleFileUpload(e);
                });
            }
            
            const imageInput = document.getElementById('image-input');
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    logUserInteraction('image_uploaded', 'image-input', 'file', file ? file.name : null, {
                        file_size: file ? file.size : 0,
                        file_type: file ? file.type : null
                    });
                    handleImageUpload(e);
                });
            }
            
            // Chat input handlers
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        logUserInteraction('chat_message_sent', 'chat-input', 'keypress', 'Enter', {
                            message_length: this.value.length
                        });
                        sendChatMessage();
                    }
                });
            }
            
            if (chatSend) {
                chatSend.addEventListener('click', function() {
                    logUserInteraction('chat_message_sent', 'chat-send', 'button', 'click', {
                        message_length: chatInput ? chatInput.value.length : 0
                    });
                    sendChatMessage();
                });
            }
            
            // Analyze button handler
            const analyzeButton = document.getElementById('analyze-button');
            if (analyzeButton) {
                analyzeButton.addEventListener('click', function() {
                    logUserInteraction('analyze_data_clicked', 'analyze-button', 'button', 'click', {
                        analysis_type: analysisTypeSelect ? analysisTypeSelect.value : null,
                        data_length: document.getElementById('text-input') ? document.getElementById('text-input').value.length : 0
                    });
                    analyzeData();
                });
            }
            
            // Fill test data button
            const fillTestDataButton = document.querySelector('.test-data-banner button');
            if (fillTestDataButton) {
                fillTestDataButton.addEventListener('click', function() {
                    logUserInteraction('fill_test_data_clicked', 'fill-test-data', 'button', 'click');
                    fillTestData();
                });
            }
            
            // Drag and drop handlers
            setupDragAndDrop();
        }

        // Toggle input sections based on analysis type
        function toggleInputSections() {
            const analysisType = document.getElementById('analysis-type').value;
            const sections = document.querySelectorAll('.conditional-section');
            
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            if (analysisType === 'statistical_test') {
                document.getElementById('statistical-section').style.display = 'block';
            } else if (analysisType === 'descriptive_statistics') {
                document.getElementById('descriptive-section').style.display = 'block';
            } else if (analysisType === 'network_analysis') {
                document.getElementById('network-section').style.display = 'block';
            } else if (analysisType === 'image_analysis') {
                document.getElementById('image-section').style.display = 'block';
            }
        }

        // Fill test data function
        function fillTestData() {
            // Fill all form fields with comprehensive sample data
            const dataDescription = document.getElementById('data-description');
            const textInput = document.getElementById('text-input');
            const analysisType = document.getElementById('analysis-type');
            const researchContext = document.getElementById('research-context');
            const targetInsights = document.getElementById('target-insights');
            const audienceLevel = document.getElementById('audience-level');
            
            // Set analysis type to statistical test
            if (analysisType) {
                analysisType.value = 'statistical_test';
            }
            
            // Fill data description
            if (dataDescription) {
                dataDescription.value = `Investigating the effectiveness of online learning platforms in predicting student academic performance. The study compares high-achieving students (GPA > 3.5) with low-achieving students (GPA < 2.5) to understand key factors that influence learning outcomes in digital environments. We want to develop a predictive model that can identify at-risk students early and provide targeted interventions.`;
            }
            
            // Fill research context
            if (researchContext) {
                researchContext.value = `Study comparing high and low achievers in online learning environments. Sample includes 200 undergraduate students using a learning management system for mathematics courses. Data collected over 12 weeks including login frequency, assignment completion rates, discussion participation, and final grades.`;
            }
            
            // Fill target insights
            if (targetInsights) {
                targetInsights.value = `Identify key behavioral patterns that distinguish high and low achievers, develop predictive models for early intervention, understand the relationship between online engagement and academic performance, and provide actionable recommendations for improving student success rates.`;
            }
            
            // Set audience level
            if (audienceLevel) {
                audienceLevel.value = 'graduate';
            }
            
            // Fill comprehensive test data
            if (textInput) {
                textInput.value = `COMPREHENSIVE EDUCATIONAL RESEARCH DATA ANALYSIS

STUDY: Online Learning Platform Predictive Model for Student Performance
SAMPLE SIZE: 200 undergraduate students (100 high achievers, 100 low achievers)
DURATION: 12 weeks
PLATFORM: Learning Management System (LMS)

DESCRIPTIVE STATISTICS:
High Achievers (GPA > 3.5):
- Mean GPA: 3.78 (SD = 0.23)
- Mean login frequency: 4.2 times/week (SD = 1.1)
- Mean assignment completion: 94.3% (SD = 5.2)
- Mean discussion posts: 8.7 per week (SD = 2.3)
- Mean study time: 12.4 hours/week (SD = 3.1)

Low Achievers (GPA < 2.5):
- Mean GPA: 2.12 (SD = 0.31)
- Mean login frequency: 1.8 times/week (SD = 1.4)
- Mean assignment completion: 67.2% (SD = 18.5)
- Mean discussion posts: 2.1 per week (SD = 1.8)
- Mean study time: 6.8 hours/week (SD = 4.2)

STATISTICAL TEST RESULTS:

1. T-Test: High vs Low Achievers - Login Frequency
t(198) = 12.45, p < 0.001, Cohen's d = 1.89
95% CI: [2.1, 2.7]
Effect Size: Large (d = 1.89)

2. T-Test: High vs Low Achievers - Assignment Completion
t(198) = 15.67, p < 0.001, Cohen's d = 2.34
95% CI: [24.8, 29.4]
Effect Size: Very Large (d = 2.34)

3. T-Test: High vs Low Achievers - Discussion Participation
t(198) = 18.23, p < 0.001, Cohen's d = 2.78
95% CI: [5.9, 7.3]
Effect Size: Very Large (d = 2.78)

4. T-Test: High vs Low Achievers - Study Time
t(198) = 9.87, p < 0.001, Cohen's d = 1.45
95% CI: [4.8, 6.4]
Effect Size: Large (d = 1.45)

CORRELATION ANALYSIS:
- GPA vs Login Frequency: r = 0.67, p < 0.001
- GPA vs Assignment Completion: r = 0.78, p < 0.001
- GPA vs Discussion Posts: r = 0.71, p < 0.001
- GPA vs Study Time: r = 0.58, p < 0.001

PREDICTIVE MODEL RESULTS:
Multiple Regression Analysis:
R¬≤ = 0.82, Adjusted R¬≤ = 0.81
F(4,195) = 89.45, p < 0.001

Predictor Variables:
1. Assignment Completion Rate: Œ≤ = 0.45, p < 0.001
2. Discussion Participation: Œ≤ = 0.32, p < 0.001
3. Login Frequency: Œ≤ = 0.28, p < 0.001
4. Study Time: Œ≤ = 0.19, p < 0.001

MODEL VALIDATION:
Cross-validation accuracy: 87.5%
Sensitivity (identifying low achievers): 89.2%
Specificity (identifying high achievers): 85.8%

KEY FINDINGS:
1. Online engagement strongly predicts academic performance
2. Assignment completion is the strongest predictor of GPA
3. Discussion participation shows significant correlation with success
4. Login frequency provides early warning indicators
5. Study time has moderate but significant predictive value

PRACTICAL IMPLICATIONS:
- Early intervention programs should focus on assignment completion
- Discussion forums should be incentivized for better engagement
- Regular login monitoring can identify at-risk students
- Study time recommendations should be personalized

RESEARCH CONTEXT: Online learning platform analysis for predictive modeling of student performance, comparing high and low achievers to develop early intervention strategies.`;
            }
            
            // Show success message
            showStatus('Comprehensive test data filled successfully! This includes high/low achiever comparison and predictive model data.', 'success');
            
            // Log the action
            fetch('/api/log-interaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: userId,
                    interaction_type: 'test_data_fill',
                    page: 'data_analyzer',
                    action: 'fill_test_data',
                    details: 'User filled form with comprehensive test data including high/low achiever comparison and predictive modeling',
                    session_data: ''
                })
            }).catch(console.error);
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // If it's an image, delegate to handleImageUpload
            if (file.type.startsWith('image/')) {
                handleImageUpload(event);
                return;
            }
            
            // Check file size (1MB limit)
            if (file.size > 1024 * 1024) {
                showStatus('File too large. Maximum size is 1MB.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('text-input').value = content;
                
                // Show file info
                const fileInfo = document.getElementById('main-file-info');
                const fileName = document.getElementById('main-file-name');
                const fileSize = document.getElementById('main-file-size');
                
                if (fileInfo && fileName && fileSize) {
                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    fileInfo.style.display = 'block';
                }
                
                showStatus('File uploaded successfully!', 'success');
            };
            reader.readAsText(file);
        }

        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            // Check file size (1MB limit)
            if (file.size > 1024 * 1024) {
                showStatus('File too large. Maximum size is 1MB.', 'error');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                // Only generate and show thumbnail, do not set textarea value
                generateThumbnail(imageData, 'main-file-thumbnail', file.type);
                // Show file info
                const fileInfo = document.getElementById('main-file-info');
                const fileName = document.getElementById('main-file-name');
                const fileSize = document.getElementById('main-file-size');
                if (fileInfo && fileName && fileSize) {
                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    fileInfo.style.display = 'block';
                }
                showStatus('Image uploaded successfully! Thumbnail generated.', 'success');
            };
            reader.readAsDataURL(file);
        }

        // Generate thumbnail from image
        function generateThumbnail(imageData, containerId, imageType) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const img = new Image();
            img.onload = function() {
                // Create canvas for thumbnail
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set thumbnail size (max 200x200)
                const maxSize = 200;
                let width = img.width;
                let height = img.height;
                
                if (width > height) {
                    if (width > maxSize) {
                        height = (height * maxSize) / width;
                        width = maxSize;
                    }
                } else {
                    if (height > maxSize) {
                        width = (width * maxSize) / height;
                        height = maxSize;
                    }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // Draw image on canvas
                ctx.drawImage(img, 0, 0, width, height);
                
                // Create thumbnail image
                const thumbnail = document.createElement('img');
                thumbnail.src = canvas.toDataURL(imageType || 'image/jpeg', 0.8);
                thumbnail.style.cssText = `
                    max-width: 200px;
                    max-height: 200px;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    margin-top: 10px;
                `;
                
                // Clear container and add thumbnail
                container.innerHTML = '';
                container.appendChild(thumbnail);
            };
            img.src = imageData;
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            const uploadSection = document.querySelector('.upload-section');
            if (uploadSection) {
                uploadSection.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    uploadSection.classList.add('dragover');
                });
                
                uploadSection.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                });
                
                uploadSection.addEventListener('drop', function(e) {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            handleImageUpload({ target: { files: [file] } });
                        } else {
                            handleFileUpload({ target: { files: [file] } });
                        }
                    }
                });
            }
        }

        // Analyze data
        async function analyzeData() {
            const dataContent = document.getElementById('text-input').value.trim();
            const dataType = document.getElementById('analysis-type').value;
            const researchContext = document.getElementById('research-context').value;
            const targetInsights = document.getElementById('target-insights').value;
            const audienceLevel = document.getElementById('audience-level').value;
            
            if (!dataContent) {
                showStatus('Please enter data to analyze.', 'error');
                return;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analyze-button').disabled = true;
            
            try {
                const response = await fetch('/api/interpret-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        data: dataContent,
                        data_type: dataType,
                        research_context: researchContext,
                        target_insights: targetInsights,
                        audience_level: audienceLevel,
                        ai_service: userSettings.ai_service || 'google',
                        ai_model: userSettings.ai_model || 'gemini-1.5-flash',
                        use_custom_keys: userSettings.use_custom_keys || false,
                        openai_key: userSettings.openai_key || '',
                        google_key: userSettings.google_key || ''
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    currentAnalysis = result.analysis;
                    document.getElementById('analysis-content').innerHTML = result.analysis.replace(/\n/g, '<br>');
                    document.getElementById('analysis-result').style.display = 'block';
                    document.getElementById('chat-section').style.display = 'block';
                    
                    showStatus('Analysis completed successfully!', 'success');
                } else {
                    showStatus('Analysis failed. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                showStatus('Analysis failed. Please check your connection and try again.', 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('analyze-button').disabled = false;
            }
        }

        // Start chat
        function startChat() {
            document.getElementById('chat-section').style.display = 'block';
            document.getElementById('chat-messages').innerHTML = `
                <div class="chat-message ai">
                    <strong>AI Interpreter:</strong> Great! I've provided an initial analysis of your data. Now let's discuss it further. You can:
                    <br><br>
                    ‚Ä¢ <strong>Ask questions</strong> about specific parts of the analysis<br>
                    ‚Ä¢ <strong>Request clarifications</strong> on statistical concepts<br>
                    ‚Ä¢ <strong>Explore implications</strong> for your research<br>
                    ‚Ä¢ <strong>Discuss limitations</strong> and alternative interpretations<br>
                    ‚Ä¢ <strong>Refine the context</strong> for better insights<br>
                    <br>
                    What would you like to discuss about your analysis?
                </div>
            `;
        }

        // Send chat message
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Log user chat message
            logChatInteraction(
                'data_interpreter_chat',
                'user_input',
                message,
                {
                    analysis_type: document.getElementById('analysis-type').value,
                    research_context: document.getElementById('research-context').value,
                    target_insights: document.getElementById('target-insights').value,
                    audience_level: document.getElementById('audience-level').value,
                    current_analysis_length: currentAnalysis.length
                }
            );
            
            // Add user message to chat
            addChatMessage('user', message);
            input.value = '';
            
            // Show loading
            document.getElementById('chat-loading').style.display = 'block';
            
            const startTime = Date.now();
            
            try {
                const response = await fetch('/api/interpret-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        current_analysis: currentAnalysis,
                        research_context: document.getElementById('research-context').value,
                        analysis_type: document.getElementById('analysis-type').value,
                        target_insights: document.getElementById('target-insights').value,
                        audience_level: document.getElementById('audience-level').value
                    })
                });
                
                const result = await response.json();
                const processingTime = Date.now() - startTime;
                
                if (result.status === 'success') {
                    // Log AI chat response
                    logChatInteraction(
                        'data_interpreter_chat',
                        'ai_response',
                        result.response,
                        {
                            user_question: message,
                            analysis_type: document.getElementById('analysis-type').value,
                            research_context: document.getElementById('research-context').value,
                            target_insights: document.getElementById('target-insights').value,
                            audience_level: document.getElementById('audience-level').value,
                            current_analysis_length: currentAnalysis.length
                        },
                        null, // ai_model will be logged by backend
                        result.response,
                        processingTime
                    );
                    
                    addChatMessage('ai', result.response);
                    
                    if (result.updated_analysis) {
                        currentAnalysis = result.updated_analysis;
                        document.getElementById('analysis-content').innerHTML = result.updated_analysis.replace(/\n/g, '<br>');
                        
                        // Log updated analysis
                        logUserInteraction('analysis_updated', 'analysis-content', 'content', 'updated', {
                            updated_analysis_length: result.updated_analysis.length,
                            trigger: 'chat_response'
                        });
                    }
                } else {
                    addChatMessage('ai', 'Sorry, I encountered an error. Please try again.');
                    
                    // Log error
                    logUserInteraction('chat_error', 'chat-system', 'error', 'api_error', {
                        error_message: 'API response error',
                        processing_time: processingTime
                    });
                }
            } catch (error) {
                console.error('Chat error:', error);
                addChatMessage('ai', 'Sorry, I encountered an error. Please try again.');
                
                // Log error
                logUserInteraction('chat_error', 'chat-system', 'error', 'network_error', {
                    error_message: error.message,
                    processing_time: Date.now() - startTime
                });
            } finally {
                document.getElementById('chat-loading').style.display = 'none';
            }
        }

        // Add chat message
        function addChatMessage(type, content) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            if (type === 'user') {
                messageDiv.innerHTML = `<strong>You:</strong> ${content}`;
            } else {
                messageDiv.innerHTML = `<strong>AI Interpreter:</strong> ${content}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Generate professional prompt
        function generateProfessionalPrompt() {
            const analysisType = document.getElementById('analysis-type').value;
            const researchContext = document.getElementById('research-context').value;
            const targetInsights = document.getElementById('target-insights').value;
            const audienceLevel = document.getElementById('audience-level').value;
            
            const prompt = `You are an expert data interpreter specializing in educational research and statistical analysis. Your role is to interpret various types of data outputs, statistical results, and analytical visualizations from an educational research perspective.

RESEARCH CONTEXT: ${researchContext || 'Educational research analysis'}
ANALYSIS TYPE: ${analysisType || 'General statistical analysis'}
TARGET INSIGHTS: ${targetInsights || 'Comprehensive interpretation and educational implications'}
AUDIENCE LEVEL: ${audienceLevel || 'Undergraduate'}

Please provide interpretations that include:
1. Statistical Interpretation: What the numbers/results mean
2. Educational Implications: What this means for learning/teaching
3. Practical Applications: Actionable insights
4. Limitations & Considerations: Important caveats
5. Recommendations: Next steps or applications

Always tailor your interpretation to the educational research perspective and the specified audience level.

DATA TO ANALYZE:
[Paste your data here]`;
            
            document.getElementById('professional-prompt').value = prompt;
            document.getElementById('prompt-result').style.display = 'block';
        }

        // Copy prompt to clipboard
        function copyPromptToClipboard() {
            const promptText = document.getElementById('professional-prompt');
            promptText.select();
            document.execCommand('copy');
            showStatus('Prompt copied to clipboard!', 'success');
        }

        // Download prompt
        function downloadPrompt() {
            const promptText = document.getElementById('professional-prompt').value;
            const blob = new Blob([promptText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai_analysis_prompt.txt';
            a.click();
            URL.revokeObjectURL(url);
            showStatus('Prompt downloaded!', 'success');
        }

        // Update API status
        function updateAPIStatus() {
            const statusDiv = document.getElementById('api-status');
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 6px; border: 1px solid #c3e6cb;">
                        <i class="fas fa-check-circle"></i> AI services configured and ready
                    </div>
                `;
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                statusDiv.style.background = '#28a745';
            } else if (type === 'error') {
                statusDiv.style.background = '#dc3545';
            } else {
                statusDiv.style.background = '#007bff';
            }
            
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
